---
- import_tasks: preflight.yml
  tags:
    - promtail_install
    - promtail

- import_tasks: install.yml
  become: True
  tags:
    - promtail_install
    - promtail

- name: Ensure promtail service is started and enabled (systemd)
  become: True
  systemd:
    daemon_reload: True
    name: "{{ promtail_systemd_service }}"
    state: started
    enabled: True
  when: ansible_service_mgr == 'systemd'
  tags:
    - promtail_run
    - promtail

- name: Ensure promtail service is started and enabled (launchd)
  become: True
  community.general.launchd:
    name: "{{ promtail_launchd_service }}"
    state: started
    enabled: True
  when: ansible_service_mgr == 'launchd'
  tags:
    - promtail_run
    - promtail
